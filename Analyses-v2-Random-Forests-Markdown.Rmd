---
title: "Analyses v2 Random Forests"
author: "Joey Hulbert"
date: "10/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(tidyverse)
library(randomForest)
```


### Import data

Data downloaded manually from iNat. 

```{r}
data <- read.csv("./data/observations-9.19.21.csv")
```

### Prepare dataset for extracting environmental data with climateNA

```{r}
gps <- data[c(1,22,23)]
gps <- rename(gps,lat = latitude) %>% `colnames<-`(c("ID2","lat","long")) %>% mutate(el = ".")
write.csv(gps,file="./data/gps.csv")
```


## Decade 2011-2020

### Import dataset with Decade 2011-2020


```{r}
lastdecade <- read.csv("./data/gps_Decade_2011_2020MSY.csv")
lastdecade <- rename(lastdecade, id = ID2)
```

### Merge data

```{r}
combined <- left_join(data,lastdecade,by="id")  %>% filter(MAP >0,na.rm=TRUE)
```

## TOPO Data

### Import TOPO Data

```{r}
topo <- read.csv("./data/gps plus DEM and TOPO data.csv")
topo <- rename(topo, id = ID2)
```


### Merge data

```{r}
combined2 <- left_join(combined,topo,by="id")
```

### Clean data 

#### Add consistency to factors
##### Symptoms 
```{r}
combined2$field.tree.canopy.symptoms[combined2$field.tree.canopy.symptoms=="Multiple Symptoms"] <-"Multiple Symptoms (please list in Notes)"
combined2$field.tree.canopy.symptoms[combined2$field.tree.canopy.symptoms=="multiple symptoms"] <-"Multiple Symptoms (please list in Notes)"
combined2$field.tree.canopy.symptoms[combined2$field.tree.canopy.symptoms=="thinning foliage"] <-"Thinning Canopy"
combined2$field.tree.canopy.symptoms[combined2$field.tree.canopy.symptoms=="healthy"] <-"Healthy"
combined2$field.tree.canopy.symptoms[combined2$field.tree.canopy.symptoms=="dead top"] <-"Old Dead Top (needles already gone)"
combined2 <- combined2 %>% droplevels()
combined2$field.tree.canopy.symptoms <- as.factor(combined2$field.tree.canopy.symptoms)
levels(combined2$field.tree.canopy.symptoms)
```

##### Unhealthy trees
```{r}
combined2$field.number.of.additional.unhealthy.trees..of.same.species..in.area..within.sight.[combined2$field.number.of.additional.unhealthy.trees..of.same.species..in.area..within.sight.=="4"] <- "4-6"
combined2$field.number.of.additional.unhealthy.trees..of.same.species..in.area..within.sight.[combined2$field.number.of.additional.unhealthy.trees..of.same.species..in.area..within.sight.=="5"] <- "4-6"
combined2$field.number.of.additional.unhealthy.trees..of.same.species..in.area..within.sight.[combined2$field.number.of.additional.unhealthy.trees..of.same.species..in.area..within.sight.=="2"] <- "2-3"
combined2 <- combined2 %>% droplevels()
combined2$field.number.of.additional.unhealthy.trees..of.same.species..in.area..within.sight. <- as.factor(combined2$field.number.of.additional.unhealthy.trees..of.same.species..in.area..within.sight.)
levels(combined2$field.number.of.additional.unhealthy.trees..of.same.species..in.area..within.sight.)
```

##### Tree size
```{r}
combined2$field.optional...tree.size[combined2$field.optional...tree.size == "Large"] <- "Large (too big to wrap arms around trunk)"
combined2$field.optional...tree.size[combined2$field.optional...tree.size == "Medium"] <- "Medium (can wrap arms around trunk)"
combined2$field.optional...tree.size[combined2$field.optional...tree.size == "Small"] <- "Small (can wrap hands around trunk)"
combined2$field.optional...tree.size[combined2$field.optional...tree.size == "Very Large"] <- "Very Large (would take many people to wrap arms around trunk)"
combined2 <- combined2 %>% droplevels()
combined2$field.optional...tree.size <- as.factor(combined2$field.optional...tree.size)
levels(combined2$field.optional...tree.size)
```


### Filter data

#### Only include symptoms of interest
```{r}
filtered.symptoms <- combined2  %>% filter(field.tree.canopy.symptoms=="Healthy"|field.tree.canopy.symptoms=="Thinning Canopy"|field.tree.canopy.symptoms=="New Dead Top (red or brown needles still attached)"|field.tree.canopy.symptoms=="Old Dead Top (needles already gone)"|field.tree.canopy.symptoms=="Tree is dead") %>% droplevels()
levels(filtered.symptoms$field.tree.canopy.symptoms)
```

### Subset variables
```{r}
filtered.symptoms <- filtered.symptoms[c(45:341)]
names(filtered.symptoms)
```

### Set up train and test data 

```{r}

```


### Try random forests

```{r}
rf <- randomForest(field.tree.canopy.symptoms ~.,filtered.symptoms,mtry=4,ntree=501,importance=TRUE,na.action=na.omit)
```

```{r}
rf
```

```{r}
plot(rf)
```

